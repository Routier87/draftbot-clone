# draftbot-clone â€” Code Complet

## package.json

```json
{
  "name": "draftbot-clone",
  "version": "1.0.0",
  "main": "src/index.js",
  "scripts": {
    "start": "node src/index.js",
    "deploy-commands": "node deploy-commands.js"
  },
  "dependencies": {
    "discord.js": "^14.11.0",
    "better-sqlite3": "^8.2.0",
    "dotenv": "^16.0.0"
  }
}
```

## .env.example

```
DISCORD_TOKEN=
CLIENT_ID=
GUILD_ID=
DATABASE=./data/game.sqlite
```

## Dockerfile

```
FROM node:20-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --production
COPY . .
CMD ["node", "src/index.js"]
```

## deploy-commands.js

```js
require('dotenv').config();
const { REST, Routes } = require('discord.js');
const fs = require('fs');
const path = require('path');

const commands = [];
const files = fs.readdirSync(path.join(__dirname, 'src', 'commands')).filter(f => f.endsWith('.js'));
for (const file of files) {
  const cmd = require(`./src/commands/${file}`);
  commands.push(cmd.data.toJSON());
}

const rest = new REST({ version: '10' }).setToken(process.env.DISCORD_TOKEN);

(async () => {
  try {
    console.log('Deploying slash commands...');
    await rest.put(Routes.applicationGuildCommands(process.env.CLIENT_ID, process.env.GUILD_ID), { body: commands });
    console.log('Commands deployed.');
  } catch (err) {
    console.error(err);
  }
})();
```

---

# src/

## index.js

```js
require('dotenv').config();
const { Client, GatewayIntentBits, Collection } = require('discord.js');
const fs = require('fs');
const path = require('path');

const client = new Client({ intents: [GatewayIntentBits.Guilds] });
client.commands = new Collection();

const files = fs.readdirSync(path.join(__dirname, 'commands')).filter(f => f.endsWith('.js'));
for (const file of files) {
  const cmd = require(`./commands/${file}`);
  client.commands.set(cmd.data.name, cmd);
}

client.once('ready', () => {
  console.log('DraftBot Clone running!');
});

client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;
  const cmd = client.commands.get(interaction.commandName);
  if (!cmd) return;

  try {
    await cmd.execute(interaction, client);
  } catch (err) {
    console.error(err);
    interaction.reply({ content: 'Erreur.', ephemeral: true });
  }
});

client.login(process.env.DISCORD_TOKEN);
```

---

## db.js

```js
const Database = require('better-sqlite3');
const path = require('path');
require('dotenv').config();

const db = new Database(process.env.DATABASE || './data/game.sqlite');

db.prepare(`CREATE TABLE IF NOT EXISTS users (
  id TEXT PRIMARY KEY,
  username TEXT,
  coins INTEGER DEFAULT 100,
  xp INTEGER DEFAULT 0,
  level INTEGER DEFAULT 1,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);`).run();

db.prepare(`CREATE TABLE IF NOT EXISTS inventory (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT,
  item TEXT,
  qty INTEGER DEFAULT 1,
  FOREIGN KEY(user_id) REFERENCES users(id)
);`).run();

db.prepare(`CREATE TABLE IF NOT EXISTS quests (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id TEXT,
  type TEXT,
  progress INTEGER DEFAULT 0,
  target INTEGER DEFAULT 1,
  reward_coins INTEGER DEFAULT 50,
  completed INTEGER DEFAULT 0,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP
);`).run();

module.exports = db;
```

---

# src/commands/

## ping.js

```js
const { SlashCommandBuilder } = require('discord.js');
module.exports = {
  data: new SlashCommandBuilder().setName('ping').setDescription('Pong test'),
  async execute(i) {
    i.reply(`Pong: ${Math.round(i.client.ws.ping)}ms`);
  }
};
```

## register.js

```js
const { SlashCommandBuilder } = require('discord.js');
```
